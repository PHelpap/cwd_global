---
title: "Forced vs Unforced Signals PCWD"
author: "Patricia Helpap"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r message=FALSE}
library(readr)
library(dplyr)
library(here)
library(lubridate)
library(patchwork)
library(extRemes)
library(ggplot2)
library(cwd)
library(ncdf4)
library(reshape2)
library(ggpubr)
library(maps)
library(raster)
library(rnaturalearth)
library(sf)
```

### Data prep - read in aggregated data aggregated for each region: 
```{r}
regional_results_1420 <- readRDS("~/cwd_global/data/regionalResults_1420.RData")
regional_results_1850 <- readRDS("~/cwd_global/data/regionalResults_1850.RData")

```

Calculate trend for each region: 

```{r}
#running window trend analysis with 30 year windows - 1420 epoch

# Define parameters
years <- 1420:(1420 + 430 - 1)  # Year range based on data length
window_size <- 31  # Moving window size

# Initialize a list to store results
ensemble_trends <- list()

for (region in names(regional_results_1420)) {
  # Extract data for the current region
  data <- regional_results_1420[[region]]  # Each column is an ensemble member
  n_years <- nrow(data)
  n_ensembles <- ncol(data)
  
  # Initialize a matrix to store trends (rows = years, cols = ensemble members)
  trends_matrix <- matrix(NA, nrow = n_years - window_size + 1, ncol = n_ensembles)
  midpoint_years <- years[1:(n_years - window_size + 1)] + (window_size - 1) / 2
  rownames(trends_matrix) <- midpoint_years
  colnames(trends_matrix) <- paste0("Member_", 1:n_ensembles)
  
  # Loop through each ensemble member
  for (i in 1:n_ensembles) {
    ensemble_data <- data[, i]  # Extract the ensemble member data
    
    # Calculate moving window trends
    for (start_year in 1:(n_years - window_size + 1)) {
      end_year <- start_year + window_size - 1
      window_years <- years[start_year:end_year]
      window_data <- ensemble_data[start_year:end_year]
      
      # Fit a linear model to the moving window
      if (all(!is.na(window_data))) {  # Check for missing values
        model <- lm(window_data ~ window_years)
        trends_matrix[start_year, i] <- coef(model)[2]  # Extract the slope
      }
    }
  }
  
  # Save the trend matrix for the region
  ensemble_trends[[region]] <- trends_matrix
}

# Example: Visualize trends for one ensemble member in one region
region <- "WSAF"  # Specify region
ensemble <- 1  # Specify ensemble member

plot(as.numeric(rownames(ensemble_trends[[region]])),
     ensemble_trends[[region]][, ensemble], type = "l",
     main = paste("30-Year Moving Trends for", region, "- Member", ensemble),
     xlab = "Year", ylab = "Trend (mm/yr)")
# 
write.csv(ensemble_trends, "~/cwd_global/data/1420_trends.csv")

#################################### 1850 epoch ############################################
#running window trend analysis with 30 year windows - 1850 epoch

# Define parameters
years <- 1850:(1850 + 160 - 1)  # Year range based on data length
window_size <- 31  # Moving window size

# Initialize a list to store results
ensemble_trends_1850 <- list()

for (region in names(regional_results_1850)) {
  # Extract data for the current region
  data <- regional_results_1850[[region]]  # Each column is an ensemble member
  n_years <- nrow(data)
  n_ensembles <- ncol(data)
  
  # Initialize a matrix to store trends (rows = years, cols = ensemble members)
  trends_matrix <- matrix(NA, nrow = n_years - window_size + 1, ncol = n_ensembles)
  # Adjust row names of the trends_matrix to represent the midpoints of the 30-year windows
  midpoint_years <- years[1:(n_years - window_size + 1)] + (window_size - 1) / 2
  rownames(trends_matrix) <- midpoint_years
  colnames(trends_matrix) <- paste0("Member_", 1:n_ensembles)
  
  # Loop through each ensemble member
  for (i in 1:n_ensembles) {
    ensemble_data <- data[, i]  # Extract the ensemble member data
    
    # Calculate moving window trends
    for (start_year in 1:(n_years - window_size + 1)) {
      end_year <- start_year + window_size - 1
      window_years <- years[start_year:end_year]
      window_data <- ensemble_data[start_year:end_year]
      
      # Fit a linear model to the moving window
      if (all(!is.na(window_data))) {  # Check for missing values
        model <- lm(window_data ~ window_years)
        trends_matrix[start_year, i] <- coef(model)[2]  # Extract the slope
      }
    }
  }
  
  # Save the trend matrix for the region
  ensemble_trends_1850[[region]] <- trends_matrix
}

# Example: Visualize trends for one ensemble member in one region
region <- "WSAF"  # Specify region
ensemble <- 1  # Specify ensemble member

plot(as.numeric(rownames(ensemble_trends_1850[[region]])),
     ensemble_trends_1850[[region]][, ensemble], type = "l",
     main = paste("30-Year Moving Trends for", region, "- Member", ensemble),
     xlab = "Year", ylab = "Trend (mm/yr)")
# 
write.csv(ensemble_trends_1850, "~/cwd_global/data/1850_trends.csv")

```
Calculate signal (ensemble mean) and noise (standard deviation) for each region: 

```{r}
###################### 1420 epoch ##########################
#ensemble_trends <- read.csv("~/cwd_global/data/1420_trends.csv")

# Initialize lists to store results
ensemble_means_1420 <- list()  # Mean for each region
ensemble_stds_1420 <- list()   # Standard deviation for each region

# Loop over regions
for (region_name in names(ensemble_trends)) {
  
  # Get the trends matrix for the region (time steps x ensemble members)
  trends_matrix <- ensemble_trends[[region_name]]
  
  # Calculate mean and standard deviation across ensemble members
  # Mean across rows (time steps)
  ensemble_means_1420[[region_name]] <- rowMeans(trends_matrix, na.rm = TRUE)
  
  # Standard deviation across rows (time steps)
  ensemble_stds_1420[[region_name]] <- apply(trends_matrix, 1, sd, na.rm = TRUE)
}


###################### 1850 epoch ##########################
#ensemble_trends <- read.csv("~/cwd_global/data/1850_trends.csv")

# Initialize lists to store results
ensemble_means_1850 <- list()  # Mean for each region
ensemble_stds_1850 <- list()   # Standard deviation for each region

# Loop over regions
for (region_name in names(ensemble_trends_1850)) {
  
  # Get the trends matrix for the region (time steps x ensemble members)
  trends_matrix <- ensemble_trends_1850[[region_name]]
  
  # Calculate mean and standard deviation across ensemble members
  # Mean across rows (time steps)
  ensemble_means_1850[[region_name]] <- rowMeans(trends_matrix, na.rm = TRUE)
  
  # Standard deviation across rows (time steps)
  ensemble_stds_1850[[region_name]] <- apply(trends_matrix, 1, sd, na.rm = TRUE)
}

```

Calculate Signal to noise ratio timeseries for each region i.e. EM/STD

```{r}
################## 1420 epoch ######################
# Initialize a list to store signal-to-noise ratios for each region
SNRs_1420 <- list()

# Loop over regions
for (region_name in names(ensemble_trends)) {
  
  # Get the mean and standard deviation for the region
  means <- ensemble_means_1420[[region_name]]
  stds <- ensemble_stds_1420[[region_name]]
  
  # Compute the signal-to-noise ratio (mean / standard deviation)
  # Handle cases where standard deviation is zero to avoid division by zero
  snr <- means / stds
  snr[is.infinite(snr)] <- NA  # Replace infinite values (mean / 0) with NA
  
  # Store the result in the list
  SNRs_1420[[region_name]] <- snr
}

################## 1850 epoch ######################
# Initialize a list to store signal-to-noise ratios for each region
SNRs_1850 <- list()

# Loop over regions
for (region_name in names(ensemble_trends_1850)) {
  
  # Get the mean and standard deviation for the region
  means <- ensemble_means_1850[[region_name]]
  stds <- ensemble_stds_1850[[region_name]]
  
  # Compute the signal-to-noise ratio (mean / standard deviation)
  # Handle cases where standard deviation is zero to avoid division by zero
  snr <- means / stds
  snr[is.infinite(snr)] <- NA  # Replace infinite values (mean / 0) with NA
  
  # Store the result in the list
  SNRs_1850[[region_name]] <- snr
}

```

Create Dataframe region, SNR and time: 
```{r}
# Define continent colors
continent_colors <- c(
  "Europe" = "pink",
  "North America" = "lightgreen",
  "Africa" = "purple",
  "Asia" = "orange",
  "Central America" = "lightblue",
  "South America" = "yellow",
  "Australia" = "blue",
  "Other" = "white"
)

########### 1420 period
# Convert SNR list into a data frame
snr_df_1420 <- do.call(rbind, lapply(names(SNRs_1420), function(region) {
  data.frame(
    time = as.numeric(names(SNRs_1420[[region]])),  # Extract time from names
    SNR = SNRs_1420[[region]],                     # Extract SNR values
    region = region                                # Add region identifier
  )
}))

# Add a continent column to the SNR data frame
snr_df_1420$continent <- NA  # Initialize continent column

for (continent in names(continent_mapping)) {
  snr_df_1420$continent[snr_df_1420$region %in% continent_mapping[[continent]]] <- continent
}


###### 1850 period
# Convert SNR list into a data frame
snr_df_1850 <- do.call(rbind, lapply(names(SNRs_1850), function(region) {
  data.frame(
    time = as.numeric(names(SNRs_1850[[region]])),  # Extract time from names
    SNR = SNRs_1850[[region]],                     # Extract SNR values
    region = region                                # Add region identifier
  )
}))

# Add a continent column to the SNR data frame
snr_df_1850$continent <- NA  # Initialize continent column

for (continent in names(continent_mapping)) {
  snr_df_1850$continent[snr_df_1850$region %in% continent_mapping[[continent]]] <- continent
}


```

Plot timeseries of EM/STD for WCE: 

```{r}
# Example: Visualize trends for one ensemble member in one region

plot(SNRs_1420$NZ, type = "l",
     main = paste("Signal/Noise for PCWD trends (mm/yr)"),
     xlab = "Year", ylab = "EM/STD")

plot(SNRs_1850$NZ, type = "l",
     main = paste("Signal/Noise for PCWD trends (mm/yr)"),
     xlab = "Year", ylab = "EM/STD")

```



Plot timeseries of EM/STD for all regions: 

```{r}
#################all continents for 1420 epoch ###################################

#### Europe ####
# Filter data for the selected continent (e.g., Europe)
selected_continent <- "Europe"
snr_filtered <- snr_df_1420 %>% filter(continent == selected_continent)

# Plot SNR time series
ggplot(snr_filtered, aes(x = time, y = SNR)) +
  geom_line() +  # Plot lines for each region
  geom_hline(yintercept = 1, color = "red", linetype = "dashed")+
  labs(
    x = "Year",
    y = "Signal-to-Noise Ratio of Trends (mm/yr)",
    title = paste("Signal-to-Noise Ratio Time Series for", selected_continent)
  ) +
  theme_classic() +
  theme(
    legend.position = "top",
    plot.title = element_text(hjust = 0.5, face = "bold"),  # Center the title
    strip.text = element_text(size = 10),  # Size for facet labels
    strip.background = element_rect(fill = "pink")
  ) +
  facet_wrap(~region)  # Facet by region with independent y-axis scales

#### Asia ####
# Filter data for the selected continent (e.g., Europe)
selected_continent <- "Asia"
snr_filtered <- snr_df_1420 %>% filter(continent == selected_continent)

# Plot SNR time series
ggplot(snr_filtered, aes(x = time, y = SNR)) +
  geom_line() +  # Plot lines for each region
  geom_hline(yintercept = 1, color = "red", linetype = "dashed")+
  labs(
    x = "Year",
    y = "Signal-to-Noise Ratio of Trends (mm/yr)",
    title = paste("Signal-to-Noise Ratio Time Series for", selected_continent)
  ) +
  theme_classic() +
  theme(
    legend.position = "top",
    plot.title = element_text(hjust = 0.5, face = "bold"),  # Center the title
    strip.text = element_text(size = 10),  # Size for facet labels
    strip.background = element_rect(fill = "orange")
  ) +
  facet_wrap(~region)  # Facet by region with independent y-axis scales

##### Australia ####
# Filter data for the selected continent (e.g., Europe)
selected_continent <- "Australia"
snr_filtered <- snr_df_1420 %>% filter(continent == selected_continent)

# Plot SNR time series
ggplot(snr_filtered, aes(x = time, y = SNR)) +
  geom_line() +  # Plot lines for each region
  geom_hline(yintercept = 1, color = "red", linetype = "dashed")+
  labs(
    x = "Year",
    y = "Signal-to-Noise Ratio of Trends (mm/yr)",
    title = paste("Signal-to-Noise Ratio Time Series for", selected_continent)
  ) +
  theme_classic() +
  theme(
    legend.position = "top",
    plot.title = element_text(hjust = 0.5, face = "bold"),  # Center the title
    strip.text = element_text(size = 10),  # Size for facet labels
    strip.background = element_rect(fill = "blue")
  ) +
  facet_wrap(~region)  # Facet by region with independent y-axis scales


##### Africa ####
# Filter data for the selected continent (e.g., Europe)
selected_continent <- "Africa"
snr_filtered <- snr_df_1420 %>% filter(continent == selected_continent)

# Plot SNR time series
ggplot(snr_filtered, aes(x = time, y = SNR)) +
  geom_line() +  # Plot lines for each region
  geom_hline(yintercept = 1, color = "red", linetype = "dashed")+
  labs(
    x = "Year",
    y = "Signal-to-Noise Ratio of Trends (mm/yr)",
    title = paste("Signal-to-Noise Ratio Time Series for", selected_continent)
  ) +
  theme_classic() +
  theme(
    legend.position = "top",
    plot.title = element_text(hjust = 0.5, face = "bold"),  # Center the title
    strip.text = element_text(size = 10),  # Size for facet labels
    strip.background = element_rect(fill = "purple")
  ) +
  facet_wrap(~region)  # Facet by region with independent y-axis scales


#### North America ####
# Filter data for the selected continent (e.g., Europe)
selected_continent <- "North America"
snr_filtered <- snr_df_1420 %>% filter(continent == selected_continent)

# Plot SNR time series
ggplot(snr_filtered, aes(x = time, y = SNR)) +
  geom_line() +  # Plot lines for each region
  geom_hline(yintercept = 1, color = "red", linetype = "dashed")+
  labs(
    x = "Year",
    y = "Signal-to-Noise Ratio of Trends (mm/yr)",
    title = paste("Signal-to-Noise Ratio Time Series for", selected_continent)
  ) +
  theme_classic() +
  theme(
    legend.position = "top",
    plot.title = element_text(hjust = 0.5, face = "bold"),  # Center the title
    strip.text = element_text(size = 10),  # Size for facet labels
    strip.background = element_rect(fill = "lightgreen")
  ) +
  facet_wrap(~region)  # Facet by region with independent y-axis scales

#### Central America ####
# Filter data for the selected continent (e.g., Europe)
selected_continent <- "Central America"
snr_filtered <- snr_df_1420 %>% filter(continent == selected_continent)

# Plot SNR time series
ggplot(snr_filtered, aes(x = time, y = SNR)) +
  geom_line() +  # Plot lines for each region
  geom_hline(yintercept = 1, color = "red", linetype = "dashed")+
  labs(
    x = "Year",
    y = "Signal-to-Noise Ratio of Trends (mm/yr)",
    title = paste("Signal-to-Noise Ratio Time Series for", selected_continent)
  ) +
  theme_classic() +
  theme(
    legend.position = "top",
    plot.title = element_text(hjust = 0.5, face = "bold"),  # Center the title
    strip.text = element_text(size = 10),  # Size for facet labels
    strip.background = element_rect(fill = "lightblue")
  ) +
  facet_wrap(~region)  # Facet by region with independent y-axis scales


#### South America ####
# Filter data for the selected continent (e.g., Europe)
selected_continent <- "South America"
snr_filtered <- snr_df_1420 %>% filter(continent == selected_continent)

# Plot SNR time series
ggplot(snr_filtered, aes(x = time, y = SNR)) +
  geom_line() +  # Plot lines for each region
  geom_hline(yintercept = 1, color = "red", linetype = "dashed")+
  labs(
    x = "Year",
    y = "Signal-to-Noise Ratio of Trends (mm/yr)",
    title = paste("Signal-to-Noise Ratio Time Series for", selected_continent)
  ) +
  theme_classic() +
  theme(
    legend.position = "top",
    plot.title = element_text(hjust = 0.5, face = "bold"),  # Center the title
    strip.text = element_text(size = 10),  # Size for facet labels
    strip.background = element_rect(fill = "yellow")
  ) +
  facet_wrap(~region)  # Facet by region with independent y-axis scales

```

```{r}
#################all continents for 1850 epoch ###################################

#### Europe ####
# Filter data for the selected continent (e.g., Europe)
selected_continent <- "Europe"
snr_filtered <- snr_df_1850 %>% filter(continent == selected_continent)

# Plot SNR time series
ggplot(snr_filtered, aes(x = time, y = SNR)) +
  geom_line() +  # Plot lines for each region
  geom_hline(yintercept = 1, color = "red", linetype = "dashed")+
  labs(
    x = "Year",
    y = "Signal-to-Noise Ratio of Trends (mm/yr)",
    title = paste("Signal-to-Noise Ratio Time Series for", selected_continent)
  ) +
  theme_classic() +
  theme(
    legend.position = "top",
    plot.title = element_text(hjust = 0.5, face = "bold"),  # Center the title
    strip.text = element_text(size = 10),  # Size for facet labels
    strip.background = element_rect(fill = "pink")
  ) +
  facet_wrap(~region)  # Facet by region with independent y-axis scales

#### Asia ####
# Filter data for the selected continent (e.g., Europe)
selected_continent <- "Asia"
snr_filtered <- snr_df_1850 %>% filter(continent == selected_continent)

# Plot SNR time series
ggplot(snr_filtered, aes(x = time, y = SNR)) +
  geom_line() +  # Plot lines for each region
  geom_hline(yintercept = 1, color = "red", linetype = "dashed")+
  labs(
    x = "Year",
    y = "Signal-to-Noise Ratio of Trends (mm/yr)",
    title = paste("Signal-to-Noise Ratio Time Series for", selected_continent)
  ) +
  theme_classic() +
  theme(
    legend.position = "top",
    plot.title = element_text(hjust = 0.5, face = "bold"),  # Center the title
    strip.text = element_text(size = 10),  # Size for facet labels
    strip.background = element_rect(fill = "orange")
  ) +
  facet_wrap(~region)  # Facet by region with independent y-axis scales

##### Australia ####
# Filter data for the selected continent (e.g., Europe)
selected_continent <- "Australia"
snr_filtered <- snr_df_1850 %>% filter(continent == selected_continent)

# Plot SNR time series
ggplot(snr_filtered, aes(x = time, y = SNR)) +
  geom_line() +  # Plot lines for each region
  geom_hline(yintercept = 1, color = "red", linetype = "dashed")+
  labs(
    x = "Year",
    y = "Signal-to-Noise Ratio of Trends (mm/yr)",
    title = paste("Signal-to-Noise Ratio Time Series for", selected_continent)
  ) +
  theme_classic() +
  theme(
    legend.position = "top",
    plot.title = element_text(hjust = 0.5, face = "bold"),  # Center the title
    strip.text = element_text(size = 10),  # Size for facet labels
    strip.background = element_rect(fill = "blue")
  ) +
  facet_wrap(~region)  # Facet by region with independent y-axis scales


##### Africa ####
# Filter data for the selected continent (e.g., Europe)
selected_continent <- "Africa"
snr_filtered <- snr_df_1850 %>% filter(continent == selected_continent)

# Plot SNR time series
ggplot(snr_filtered, aes(x = time, y = SNR)) +
  geom_line() +  # Plot lines for each region
  geom_hline(yintercept = 1, color = "red", linetype = "dashed")+
  labs(
    x = "Year",
    y = "Signal-to-Noise Ratio of Trends (mm/yr)",
    title = paste("Signal-to-Noise Ratio Time Series for", selected_continent)
  ) +
  theme_classic() +
  theme(
    legend.position = "top",
    plot.title = element_text(hjust = 0.5, face = "bold"),  # Center the title
    strip.text = element_text(size = 10),  # Size for facet labels
    strip.background = element_rect(fill = "purple")
  ) +
  facet_wrap(~region)  # Facet by region with independent y-axis scales


#### North America ####
# Filter data for the selected continent (e.g., Europe)
selected_continent <- "North America"
snr_filtered <- snr_df_1850 %>% filter(continent == selected_continent)

# Plot SNR time series
ggplot(snr_filtered, aes(x = time, y = SNR)) +
  geom_line() +  # Plot lines for each region
  geom_hline(yintercept = 1, color = "red", linetype = "dashed")+
  labs(
    x = "Year",
    y = "Signal-to-Noise Ratio of Trends (mm/yr)",
    title = paste("Signal-to-Noise Ratio Time Series for", selected_continent)
  ) +
  theme_classic() +
  theme(
    legend.position = "top",
    plot.title = element_text(hjust = 0.5, face = "bold"),  # Center the title
    strip.text = element_text(size = 10),  # Size for facet labels
    strip.background = element_rect(fill = "lightgreen")
  ) +
  facet_wrap(~region)  # Facet by region with independent y-axis scales

#### Central America ####
# Filter data for the selected continent (e.g., Europe)
selected_continent <- "Central America"
snr_filtered <- snr_df_1850 %>% filter(continent == selected_continent)

# Plot SNR time series
ggplot(snr_filtered, aes(x = time, y = SNR)) +
  geom_line() +  # Plot lines for each region
  geom_hline(yintercept = 1, color = "red", linetype = "dashed")+
  labs(
    x = "Year",
    y = "Signal-to-Noise Ratio of Trends (mm/yr)",
    title = paste("Signal-to-Noise Ratio Time Series for", selected_continent)
  ) +
  theme_classic() +
  theme(
    legend.position = "top",
    plot.title = element_text(hjust = 0.5, face = "bold"),  # Center the title
    strip.text = element_text(size = 10),  # Size for facet labels
    strip.background = element_rect(fill = "lightblue")
  ) +
  facet_wrap(~region)  # Facet by region with independent y-axis scales


#### South America ####
# Filter data for the selected continent (e.g., Europe)
selected_continent <- "South America"
snr_filtered <- snr_df_1850 %>% filter(continent == selected_continent)

# Plot SNR time series
ggplot(snr_filtered, aes(x = time, y = SNR)) +
  geom_line() +  # Plot lines for each region
  geom_hline(yintercept = 1, color = "red", linetype = "dashed")+
  labs(
    x = "Year",
    y = "Signal-to-Noise Ratio of Trends (mm/yr)",
    title = paste("Signal-to-Noise Ratio Time Series for", selected_continent)
  ) +
  theme_classic() +
  theme(
    legend.position = "top",
    plot.title = element_text(hjust = 0.5, face = "bold"),  # Center the title
    strip.text = element_text(size = 10),  # Size for facet labels
    strip.background = element_rect(fill = "yellow")
  ) +
  facet_wrap(~region)  # Facet by region with independent y-axis scales

```

Plot Bar plot for each region for both epochs of EM/STD:

```{r}
# Add a 'time' column to distinguish between the two datasets
snr_df_1420$time_period <- "1420"
snr_df_1850$time_period <- "1850"

# Combine the two dataframes
combined_snr_df <- rbind(snr_df_1420, snr_df_1850)

```

```{r}
#### Europe ####
# Filter data for the selected continent (e.g., Europe)
selected_continent <- "Europe"
comb_snr_filtered <- combined_snr_df %>% filter(continent == selected_continent)
# Plot boxplots for SNR with time period distinction
ggplot(comb_snr_filtered, aes(x = time_period, y = SNR, fill = time_period)) +
  geom_boxplot() +  # Boxplot for the SNR
  geom_hline(yintercept = 1, linetype = "dashed", color = "darkgrey")+
  labs(
    x = "Time Period",
    y = "Signal-to-Noise Ratio (mm/yr)",
    title = paste("Signal-to-Noise Ratio Boxplots for", selected_continent)
  ) +
  theme_classic() +
  theme(
    legend.position = "top",
    plot.title = element_text(hjust = 0.5, face = "bold"),  # Center the title
    strip.text = element_text(size = 10),  # Size for facet labels
    strip.background = element_rect(fill = "pink")
  ) +
  facet_wrap(~region) +  # Facet by region
  scale_fill_manual(values = c("1420" = "red", "1850" = "blue"))  # Customize colors

#### Asia ####
# Filter data for the selected continent (e.g., Europe)
selected_continent <- "Asia"
comb_snr_filtered <- combined_snr_df %>% filter(continent == selected_continent)
# Plot boxplots for SNR with time period distinction
ggplot(comb_snr_filtered, aes(x = time_period, y = SNR, fill = time_period)) +
  geom_boxplot() +  # Boxplot for the SNR
  geom_hline(yintercept = 1, linetype = "dashed", color = "darkgrey")+
  labs(
    x = "Time Period",
    y = "Signal-to-Noise Ratio (mm/yr)",
    title = paste("Signal-to-Noise Ratio Boxplots for", selected_continent)
  ) +
  theme_classic() +
  theme(
    legend.position = "top",
    plot.title = element_text(hjust = 0.5, face = "bold"),  # Center the title
    strip.text = element_text(size = 10),  # Size for facet labels
    strip.background = element_rect(fill = "orange")
  ) +
  facet_wrap(~region) +  # Facet by region
  scale_fill_manual(values = c("1420" = "red", "1850" = "blue"))  # Customize colors


#### Australia ####
# Filter data for the selected continent (e.g., Europe)
selected_continent <- "Australia"
comb_snr_filtered <- combined_snr_df %>% filter(continent == selected_continent)
# Plot boxplots for SNR with time period distinction
ggplot(comb_snr_filtered, aes(x = time_period, y = SNR, fill = time_period)) +
  geom_boxplot() +  # Boxplot for the SNR
  geom_hline(yintercept = 1, linetype = "dashed", color = "darkgrey")+
  labs(
    x = "Time Period",
    y = "Signal-to-Noise Ratio (mm/yr)",
    title = paste("Signal-to-Noise Ratio Boxplots for", selected_continent)
  ) +
  theme_classic() +
  theme(
    legend.position = "top",
    plot.title = element_text(hjust = 0.5, face = "bold"),  # Center the title
    strip.text = element_text(size = 10),  # Size for facet labels
    strip.background = element_rect(fill = "blue")
  ) +
  facet_wrap(~region) +  # Facet by region
  scale_fill_manual(values = c("1420" = "red", "1850" = "blue"))  # Customize colors

#### Africa ####
# Filter data for the selected continent (e.g., Europe)
selected_continent <- "Africa"
comb_snr_filtered <- combined_snr_df %>% filter(continent == selected_continent)
# Plot boxplots for SNR with time period distinction
ggplot(comb_snr_filtered, aes(x = time_period, y = SNR, fill = time_period)) +
  geom_boxplot() +  # Boxplot for the SNR
  geom_hline(yintercept = 1, linetype = "dashed", color = "darkgrey")+
  labs(
    x = "Time Period",
    y = "Signal-to-Noise Ratio (mm/yr)",
    title = paste("Signal-to-Noise Ratio Boxplots for", selected_continent)
  ) +
  theme_classic() +
  theme(
    legend.position = "top",
    plot.title = element_text(hjust = 0.5, face = "bold"),  # Center the title
    strip.text = element_text(size = 10),  # Size for facet labels
    strip.background = element_rect(fill = "purple")
  ) +
  facet_wrap(~region) +  # Facet by region
  scale_fill_manual(values = c("1420" = "red", "1850" = "blue"))  # Customize colors

#### North America ####
# Filter data for the selected continent (e.g., Europe)
selected_continent <- "North America"
comb_snr_filtered <- combined_snr_df %>% filter(continent == selected_continent)
# Plot boxplots for SNR with time period distinction
ggplot(comb_snr_filtered, aes(x = time_period, y = SNR, fill = time_period)) +
  geom_boxplot() +  # Boxplot for the SNR
  geom_hline(yintercept = 1, linetype = "dashed", color = "darkgrey")+
  labs(
    x = "Time Period",
    y = "Signal-to-Noise Ratio (mm/yr)",
    title = paste("Signal-to-Noise Ratio Boxplots for", selected_continent)
  ) +
  theme_classic() +
  theme(
    legend.position = "top",
    plot.title = element_text(hjust = 0.5, face = "bold"),  # Center the title
    strip.text = element_text(size = 10),  # Size for facet labels
    strip.background = element_rect(fill = "lightgreen")
  ) +
  facet_wrap(~region) +  # Facet by region
  scale_fill_manual(values = c("1420" = "red", "1850" = "blue"))  # Customize colors

#### Central America ####
# Filter data for the selected continent (e.g., Europe)
selected_continent <- "Central America"
comb_snr_filtered <- combined_snr_df %>% filter(continent == selected_continent)
# Plot boxplots for SNR with time period distinction
ggplot(comb_snr_filtered, aes(x = time_period, y = SNR, fill = time_period)) +
  geom_boxplot() +  # Boxplot for the SNR
  geom_hline(yintercept = 1, linetype = "dashed", color = "darkgrey")+

  labs(
    x = "Time Period",
    y = "Signal-to-Noise Ratio (mm/yr)",
    title = paste("Signal-to-Noise Ratio Boxplots for", selected_continent)
  ) +
  theme_classic() +
  theme(
    legend.position = "top",
    plot.title = element_text(hjust = 0.5, face = "bold"),  # Center the title
    strip.text = element_text(size = 10),  # Size for facet labels
    strip.background = element_rect(fill = "lightblue")
  ) +
  facet_wrap(~region) +  # Facet by region
  scale_fill_manual(values = c("1420" = "red", "1850" = "blue"))  # Customize colors


#### South America ####
# Filter data for the selected continent (e.g., Europe)
selected_continent <- "South America"
comb_snr_filtered <- combined_snr_df %>% filter(continent == selected_continent)
# Plot boxplots for SNR with time period distinction
ggplot(comb_snr_filtered, aes(x = time_period, y = SNR, fill = time_period)) +
  geom_boxplot() +  # Boxplot for the SNR
  geom_hline(yintercept = 1, linetype = "dashed", color = "darkgrey")+
  labs(
    x = "Time Period",
    y = "Signal-to-Noise Ratio (mm/yr)",
    title = paste("Signal-to-Noise Ratio Boxplots for", selected_continent)
  ) +
  theme_classic() +
  theme(
    legend.position = "top",
    plot.title = element_text(hjust = 0.5, face = "bold"),  # Center the title
    strip.text = element_text(size = 10),  # Size for facet labels
    strip.background = element_rect(fill = "yellow")
  ) +
  facet_wrap(~region) +  # Facet by region
  scale_fill_manual(values = c("1420" = "red", "1850" = "blue"))  # Customize colors
```











